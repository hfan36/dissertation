\chapter{Feasibility study using Model Observer}
\label{chap:model_observer}

\section{Introduction}
When evaluating an imaging system, it is often useful to first use a model observer to compute the performance of the system.  One can optimize the imaging system by calculating its performance using the model observer for a particular task with multiple input parameters.  Considerable research has been performed in computed tomography (CT) on signal detection in flat backgrounds under various conditions, but little has been done with complex, random backgrounds.  In this chapter we present a new way to evaluate the detector for signal detection task using raw projection data.  This work utilizes the channelized Hotelling observer and the correlation between all pairs of channels over discrete angles to compute the signal-to-noise ration (SNR) as a figure of merit for the detector.  The variables considered are number of incident x-ray photon per pixel, mean number of photoelectrons per x-ray photon, variance of camera read noise, the number of detector pixels, and the lumpiness of the background.  The detector considered is a scintillator coupled to a small pixelated detector by a lens.

The best observer that can be used is the ideal observer or Bayesian observer, and its defined as the observer that utilizes all statistical information available regarding the task to maximize task performance as measured by Bayes risk or some other related measure of performance~\citep{Barrett2004}.  However this method requires us to know the exact statistical properties about our imaging system, which is next to impossible.  A much simpler observer is the Hotelling observer that only requires us to know the mean and variance of our images.  Although this sounds simple, even the Hotelling observer is extremely computationally intensive and very impractical.  So we opted to use the next best thing, the channelized Hotellinng observer,  to measure the system performance.  
The channels essentially approximate the Hotelling observer by a number of channels, or mathematical functions.  Different channels can be selected depending on the tasks at hand.  An advantage to use the channelized Hotelling observer is that they require less computation to calculate the covariance matrix of the observer.

\section{Theory}
In x-ray imaging, the x-ray photons are attenuated when they pass through a material.  For a monochromatic incident x-ray beam, the attenuation of the x-ray depends on the attenuation coefficient of the material and is expressed by the equation~\citep{Barrett2004}:

\begin{equation}
\label{xrayeqn}
\overline{N}_m = \overline{N}_0 \exp\left[-\int_0^{\infty} \! \mathrm{d}l \,\mu(\mathbf{r}_{m}-\hat{\mathbf{s}}_m l )\right],
\end{equation}

\noindent where $\overline{N}_0$ is the mean number of x-ray photons that would strike the detector m with no object present, $\mathbf{r}_m$ is the 3-D vector specifying the location of the detector m, $\mathbf{\hat{s}}_m$ is a unit vector from the source to detector m, and $\mu(\bf{r})$ is the attenuation function of the object.  This assumes all rays from the x-ray point source to the detector subtend small angles ($\cos(\theta)\approx 1$), so $\overline{N}_0$ is the same for all $m$.  The attenuation function of the object for this simulation is:

\begin{equation}
\label{obj_eqn}
\mu({\mathbf{r}}) = \mu_{H_2o} \, sph(\mathbf{r}/D) + \Delta\mu({\mathbf{r}}), 
\end{equation}

\noindent
where $\mu_{H_2o}$ is the attenuation coefficient of water, $\bf{r}$ is a 3-D vector in Cartesian coordinate, $sph(\textbf{r}/D)$ is a spherical function of diameter $D$, where $sph(\textbf{r}/D)=1$ for$|\textbf{r}|<D/2$, and $0$ otherwise.  $\Delta \mu(\textbf{r})$ is the lumpy background model used by Rolland~\citep{Rolland1992} and is given by:

\begin{equation}
\label{lumpy}
\Delta\mu(r) = \sum\limits_{j = 1}^{K}\Delta\mu_0 \exp\left(-\frac{|\mathbf{r}-\mathbf{r}_j|^2}{2r_b^2}   \right),
\end{equation}

\noindent
where $\mathbf{r}_j$ is a random vector confined to a spherical diameter $d$, $K$ is the number of Gaussian lumps in the background, $\Delta\mu_0$ is the amplitude of the lump, and $r_b$ is the rms radius of the Gaussian lumps.  Note that $K$ is taken from a Poisson distribution with mean $\overline{K}$ and $\mathbf{r}_j$ is taken from a uniform distribution.  The values $\overline{K}$ and $\Delta\mu_0$ are chosen so the mean of the lumpy background is equal to the attenuation coefficient of water.
\noindent
Using Eqn.~\ref{xrayeqn} the mean number of x-ray photons incident on the detector when $\Delta\mu(r) \ll d$ is

\begin{equation}
\label{xrayeqnapprox}
\overline{N}_m \approx \overline{N}_{0m} \left\{1-\int_{0}^{\infty} \mathrm{d}l \Delta\mu(\mathbf{r}_m - \mathbf{\hat{s}}_ml)\right\} \equiv \overline{N}_{0m}[1-\Delta p_m],
\end{equation}

\noindent
where $\overline{N}_{0m} \equiv \overline{N}_0 \exp\{-\mu_{H_2o} \int_0^{\infty} dl\,$sph$[(\mathbf{r}_m-\mathbf{s}_m )/D] \} $ and $\Delta p_m \equiv \int_0^{\infty} dl \, \Delta \mu(\mathbf{r}_m-\mathbf{\hat{s}}_m l)$.  Because the read noise has zero mean, we can write the projected value of the object on the detector $m$ in electron units as

\begin{equation}
\label{gbar}
\bar{g}_{m0} = \eta \bar{k}\overline{N}_{0m}[1-\Delta p_m],
\end{equation}

\noindent 
This is the conditional mean for a single realization of the lumpy background, with the data averaged over the Poisson fluctuations of the number of x-ray photons, over the photoelectron generation process, and over read noise.  In this equation, $\eta$ is the quantum efficiency and $\bar{k}$ is the number of photoelectrons produced per incident x-ray photon.  These values are assumed to be the same for all detectors.  The overall mean, including an average over lumpy backgrounds, is then given by

\begin{equation}
\label{gdoublebar}
\bar{\bar{g}}_{m0} = \eta\bar{k}\overline{N}_{0m}[1-\Delta \bar{p}_m].
\end{equation}

\noindent
The signal used in this study is the 2-D Gaussian function.  So in the signal present case, the projected value on the detector and its mean are $\bar{g}_{m1} = \eta \bar{k}\, \overline{N}_{0m}[1 - \Delta p_m - \Delta s_m]$ and $ \bar{\bar{g}}_{m1} = \eta\bar{k}\, \overline{N}_{0m}[1 - \Delta \bar{p}_m - \Delta\bar{s}_m]$,  where $\Delta s_m \equiv \int_0^{\infty}dl \, \Delta \mu_s (\mathbf{r}_m - \mathbf{\hat{s}}_m l)$, and $\Delta\mu_s$ is the signal amplitude.
When both measurement noise and object variability are taken into account, the general covariance matrix in component form is defined by~\citep{Barrett2004}

\begin{equation}
\label{gen covariance}
[\mathbf{K_g}]_{mm'} \equiv \langle \langle[g_m-\bar{\bar{g}}_m][g_{m'}-\bar{\bar{g}}_{m'}]\rangle_{\mathbf{g}|\Delta\mu} \rangle_{\Delta\mu}.
\end{equation}

\noindent
Equation~\ref{gen covariance} simplifies down to two terms, one representing the average noise covariance and the other representing the object variability.  These two terms are described by the equation

\begin{equation}
\label{gen covariance2}
[\mathbf{K_g}]_{mm'} = [\overline{\mathbf{K}}_\mathbf{g}^{noise}]_{mm'}+[\mathbf{K}_{\mathbf{\bar{g}}}^{obj}]_{mm'}.
\end{equation}

\noindent
The noise term in the data covariance matrix is diagonal because we are assuming that there is no light spread in the scintillator (e.g. columnar scintillator crystals) and in the coupling optics between scintillator and optical detector.  So it follows from Burgess variance theorem~\citep{Barrett2004} that the covariance matrix due to noise is 

\begin{equation}
\label{noise covariance}
[\overline{\mathbf{K}}_\mathbf{g}^{noise}]_{mm'}= \delta_{mm'}[\sigma^2 + \eta^2 \overline{N}_{0m} (\sigma_k^2 + \bar{k}^2)\langle(1-\Delta p_m)^2 \rangle_{\Delta\mu}].
\end{equation}

\noindent
In equation \ref{noise covariance}, $\sigma^2$ is the variance of the camera read noise and $\sigma_k^2$ is the variance in the number of photoelectrons per x-ray photon.  These variables are assumed to be the same for all detectors.
The covariance matrix representing object variability is not diagonal, and its elements are given by

\begin{equation}
\label{object covariance}
[\mathbf{K}_{\mathbf{\bar{g}}}^{obj}]_{mm'}=\eta^2\bar{k}^2\overline{N}_{0m}\overline{N}_{0m'} \langle[\Delta p_m - \Delta \bar{p}_m][\Delta p_{m'}-\Delta \bar{p}_{m'}]\rangle _{\Delta \mu}.
\end{equation}

\noindent
The observer used for the task of signal detection is the channelized Hotelling observer.  The application of using channelized observers for medical image-quality assessment is well established.  It began with the work of Myers~\citep{MyersThesis} and Myers and Barrett~\citep{Myers1987}, who introduced the channelized Hotelling observer.  Others have used the channelized observer estimate the ideal linear observer and assess images~\citep{Gallas2003,Abbey2000, Abbey2001}.  Detailed works can be found in Abbey~\citep{AbbeyThesis} and Abbey and Bochud~\citep{Abbey2000} , for the purpose of this work, only the essential equations are provided for SNR calculation.
The SNR for the channelized Hotelling observer is given by:

\begin{equation}
\label{SNR hot}
\mathrm{SNR^2_{Hot} = [\Delta \mathbf{\bar{v}}^t]\mathbf{K_v^{-1}}[\Delta \mathbf{\bar{v}}]},
\end{equation}

\noindent
where $\mathrm{\Delta \mathbf{\bar{v}} = U^t(\mathbf{\bar{g}_1}-\mathbf{\bar{g}_0)}}$, $\mathrm{K_v= U^t(\mathbf{K_g})U}$, and $\mathrm{U}$ is the channel template.  In this study we used 5 channels and the observer templates are the Laguerre-Gauss functions.  This set of functions are used to detect the Gaussian signal because they form a basis on the space of rotationally symmetric square-integrable functions so they can represent any rotationally symmetric function that is square integrable.  Since we have prior knowledge of the signal, both its exact location and the fact that the signal is rotationally symmetrical, the Laguerre-Gauss functions are a good choice for the observer template.  Note that these channels were chosen not to mimic human performance but to estimate the ideal-observer performance.

\section{Simulation Model}
For this simulation, the object function parameters $D$ and $d$ equal to 500 mm and 20 mm respectively.  The attenuation coefficient of water $(\mu_{H_2o})$ equals to 0.02 mm$^{-1}$.  The object function is placed 500 mm behind the x-ray point source, and the screen is placed 1000 mm away from the x-ray source.  The size of the screen is 80 mm$\times$80 mm.  The projection data is calculated using a fixed detector size and a different number of pixels.  Figure \ref{fig:system geometry} provides the overall system geometry considered in this study.  The radius of each lump for the random background was set to 4.5 mm and the mean number of lumps that resides inside the sphere with diameter $d$ was set to 180.  The radius of the lumps and the mean number of lumps where chosen so that two points closer together has higher correlation compared with two points farther apart.

\begin{figure}
\includegraphics[height = 8cm]{systemGeometry2}
\caption{System geometry}
\label{fig:system geometry}
\end{figure} 

\noindent
The projection of the object function is calculated for 36 discrete angular increments about its vertical axis for both signal-present and signal-absent cases.  The process is then repeated several hundred times using different object functions for various signal sizes and amplitudes.  The channelized-Hotelling observer is trained for each signal radius, and the channelized covariance matrix is calculated between all pairs of channels as a function of angle.  The final SNR represents the ability of the detector to detect the signal using the raw projection data over 36 discrete angles.  Figure \ref{fig: channel template} is an example of the Laguerre-Gauss channel template for one particular signal size.

\begin{figure}[ht]
\includegraphics[width=1.0in]{ch0}
\includegraphics[width=1.0in]{ch1}
\includegraphics[width=1.0in]{ch2}
\includegraphics[width=1.0in]{ch3}
\includegraphics[width=1.0in]{ch4} 
\caption{The first 5 channels of Laguerre-Gauss function for signal diameter = 2 mm}
\label{fig: channel template} 
\end{figure}

\section{Results}
The Hotelling observer implements the optimal linear discriminant. The correlation between each channel pair of the Hotelling observer is calculated for all projection angles.  As a result, the relationship between each angle and channel pair increases the information content of the covariance matrix and the observer's ability to discriminate between signal-present and signal-absent cases. Figure~\ref{fig: covarianceTable} shows the cross correlation between all pairs of Hotelling channels over 360 degrees.  With our problem set-up, the covariance matrix is statistically stationary in the angle variable, so only one angle is needed in these plots.

\begin{figure}[ht]
\includegraphics[width = 6in]{covarianceTable}
\caption{covariance values between channel pairs over projection angles}
\label{fig: covarianceTable}
\end{figure}

\begin{figure}[ht]
	\begin{subfigure}[b]{0.3\linewidth}
		\includegraphics[scale=0.8]{varyN0}
		\caption{}
		\label{fig:varyN0}
	\end{subfigure}
	\hspace{0.2cm}
	\begin{subfigure}[b]{0.3\linewidth}
		\includegraphics[scale=0.8]{varySigma}
		\caption{}
		\label{fig:varySigma}
	\end{subfigure}
	\hspace{0.2cm}	
	\begin{subfigure}[b]{0.3\linewidth}
		\includegraphics[scale=0.8]{varykbar}
		\caption{}
		\label{fig:varykbar}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\linewidth}
		\includegraphics[scale=0.8]{varyPixel}
		\caption{}
		\label{fig:varyPixel}
	\end{subfigure}	
	\hspace{0.2cm}	
	\begin{subfigure}[b]{0.3\linewidth}
		\includegraphics[scale=0.8]{varyBG}
		\caption{}
		\label{fig:varyBG}
	\end{subfigure}
\caption{Contrast-Detail diagram for SNR = 2 using a detector with $816 \times 816$ pixels for $\eta = 1$ and $\sigma_{read} = 2$.  (a): $\bar{k} = 2$, and $\sigma_{read} = 2$ when $\overline{N}_0 = $10, 50 and 100.  (b): $\bar{k} = 2$, and $\overline{N}_0 = 50$ when $ \sigma_{read} = $1, 2 and 5.  (c): $\bar{N}_0 = 50$ and $\sigma_{read} = 2$ when $\bar{k} = $1, 2, 5 and 16.  (d): using 4 detectors with $816 \times 816$ pixels, $612 \times 612$ pixels, $408 \times 408$ pixels, and $306 \times 306$ pixels when $\sigma_{read} = 2$, $\overline{N}_0 =$ 50 photons/0.01 mm$^2$, and $\bar{k} = 2$. (e): CD diagram for lumpy background and uniform background when $\overline{N}_0 =$ 50, $\sigma_{read} = $1, and $\bar{k} = $2}
\label{fig:CD} 
\end{figure}

%\begin{figure}
%\includegraphics[scale=1]{CD-diagrams.eps}
%\caption{Contrast-Detail diagram for SNR = 2 using a detector with $816 \times 816$ pixels for $\eta = 1$ and $\sigma_{read} = 2$.  (a): $\bar{k} = 2$, and $\sigma_{read} = 2$ when $\overline{N}_0 = $10, 50 and 100.  (b): $\bar{k} = 2$, and $\overline{N}_0 = 50$ when $ \sigma_{read} = $1, 2 and 5.  (c): $\bar{N}_0 = 50$ and $\sigma_{read} = 2$ when $\bar{k} = $1, 2, 5 and 16.  (d): using 4 detectors with $816 \times 816$ pixels, $612 \times 612$ pixels, $408 \times 408$ pixels, and $306 \times 306$ pixels when $\sigma_{read} = 2$, $\overline{N}_0 =$ 50 photons/0.01 mm$^2$, and $\bar{k} = 2$. (e): CD diagram for lumpy background and uniform background when $\overline{N}_0 =$ 50, $\sigma_{read} = $1, and $\bar{k} = $2}
%\label{fig:CD} 
%\end{figure}

\noindent
There is a linear relationship between the contrast of the signal at the detector and the SNR so a contrast-detail diagram can be calculated for a fixed SNR value.  The variables considered here are $\bar{k}$, $\overline{N}_0$, $\sigma_{read}$, the number of pixels in the detector, and the type of background (i.e. uniform vs. random).  Figure~\ref{fig:CD} shows the relationship between the variables considered in this study.  The contrast vs. detail diagrams were displayed in log-log scale to show that for a fixed SNR value, the contrast required to detect the signal increases exponentially as the signal size decreases.  As expected, $\overline{N}_0$, $\sigma_{read}$, and $\bar{k}$ are big factors that contributes to the performance of the detector shown in Fig.~\ref{fig:varyN0}~\ref{fig: varySigma}~\ref{fig:varykbar}.  The figures showed that an increase in  $\overline{N}_0$ and $\bar{k}$ provided better detector performance while $\sigma_{read}$ decreased performance.  Figure~\ref{fig:varyPixel} showed that for a fixed incident $\overline{N}_0$ per detector area, the performance decreased slightly with increased number of detector pixels.  Note that for all of the results, we did not see a point where the slope of the contrast-detail diagram transitioned from linear slope to asymptotic slope. According to Wagner and Brown~\citep{Wagner1979} this transition should occur when the signal size is near the spatial resolution limit of the detector.  We did not observer a significant change in the slope when signal sizes reached the detector pixel size.  A similar pattern was also noticed in Sain's~\citep{Sain2003} modular gamma camera experiment where the channelized Hotelling observer was also employed with Laguerre-Gauss templates.  Further evaluations are needed to verify this anomaly.

\section{Conclusion}
Using the channelized Hotelling observer on raw projection data over CT projection angles, we have shown that, at a fixed observer SNR, the contrast required to detect a signal increases dramatically as the signal size decreases.  The contrast-detail diagram was presented for different variables including number of incident x-ray photons per pixel, read noise of the camera, the number of photoelectrons per pixel collected by the detector, the number of pixels in the detector and the type background (flat vs. random background).  We have shown that this method uses the angle correlation information in the data to calculate signal detectability and it can be very useful to optimize the imaging system.